<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>TRON dApp ‚Äî WalletConnect</title>
<script src="https://cdn.jsdelivr.net/npm/@walletconnect/client@1.7.8/dist/umd/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tronweb/dist/TronWeb.js"></script>
<style>
    body { font-family: Arial, sans-serif; padding: 40px; }
    button { padding: 12px 20px; font-size: 16px; cursor: pointer; }
    pre { margin-top: 20px; background: #f4f4f4; padding: 15px; white-space: pre-wrap; }
</style>
</head>
<body>

<h2>TRON dApp ‚Äî WalletConnect</h2>
<button onclick="connectWallet()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å Trust Wallet</button>
<pre id="status">–û–∂–∏–¥–∞–Ω–∏–µ...</pre>

<script>
let walletConnector;
let tronWeb;

async function connectWallet() {
    const status = document.getElementById("status");
    status.textContent = "üîç –°–æ–∑–¥–∞—ë–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å WalletConnect...";

    // 1Ô∏è‚É£ –°–æ–∑–¥–∞—ë–º WalletConnect —Å–µ—Å—Å–∏—é
    walletConnector = new WalletConnect.default({
        bridge: "https://bridge.walletconnect.org"
    });

    // –ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞, —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º URI
    if (!walletConnector.connected) {
        await walletConnector.createSession();
        const uri = walletConnector.uri;
        status.textContent = "üì± –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ Trust Wallet:\n" + uri;
    }

    // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    walletConnector.on("connect", async (error, payload) => {
        if (error) throw error;

        const { accounts } = payload.params[0];
        const userAddress = accounts[0];
        status.textContent = "‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ: " + userAddress;

        // 2Ô∏è‚É£ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TronWeb —Å Trust Wallet
        tronWeb = new TronWeb({
            fullHost: "https://api.trongrid.io",
            privateKey: null // –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –Ω–µ –Ω—É–∂–µ–Ω, –≤—Å—ë –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç Trust Wallet
        });

        // 3Ô∏è‚É£ –ü–æ–ª—É—á–∞–µ–º –±–∞–ª–∞–Ω—Å TRX
        try {
            const balanceSun = await tronWeb.trx.getBalance(userAddress);
            const balanceTRX = balanceSun / 1_000_000;
            status.textContent += `\nüí∞ –ë–∞–ª–∞–Ω—Å: ${balanceTRX} TRX`;
        } catch (err) {
            status.textContent += "\n‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å: " + err.message;
        }
    });

    walletConnector.on("disconnect", (error, payload) => {
        if (error) throw error;
        status.textContent = "‚ùå –û—Ç–∫–ª—é—á–µ–Ω–æ";
    });
}
</script>

</body>
</html>
